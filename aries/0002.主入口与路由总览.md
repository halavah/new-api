# 0002. 主入口与路由总览

## 适合人群
- 有 Java 背景的 Go 初学者，想快速把握服务启动流程与路由分发。

## 主入口 main.go 概览
- 职责：初始化配置、数据库、缓存、路由、中间件，启动 HTTP 服务器。
- 关键步骤（简化视角）：
  1) 载入环境与常量（common/init、common/constants）。
  2) 初始化数据库与日志（model.InitDB / InitLogDB）。
  3) 初始化缓存、任务、同步逻辑（如渠道缓存、配置热更新）。
  4) 构建 Gin 引擎与中间件链（日志、CORS、鉴权、限流、恢复等）。
  5) 注册路由：router/main.go → 聚合 api-router、relay-router、video-router、web-router。
  6) 监听端口（默认 3000），嵌入静态资源 web/dist（Go embed）。

## 路由划分
- `router/main.go`：汇总路由注册，划分模块。
- `router/api-router.go`：控制台/管理类 API，面向内部/管理端。
- `router/relay-router.go`：中继/转发入口，承载各厂商/模型的请求路由。
- `router/video-router.go`：视频/媒体相关路由。
- `router/web-router.go`：静态页面/前端入口（嵌入 web/dist）。
- `router/dashboard.go`：仪表盘类接口聚合。

## 中间件链路（简述）
- 典型顺序：请求 ID → 恢复 → 日志 → CORS → 鉴权/限流/安全校验 → 业务处理。
- 位置：`middleware/` 目录，按需在 router/main.go 或各子路由注册。

## 依赖关系（对照 Java 思维）
- main.go 相当于 Spring Boot 的启动类，router/* 类似于控制器/路由注册，middleware 类似 Filter/Interceptor，service/relay/model 则对应服务层、适配层、数据层。
- Go 侧依赖注入多为手工组织（本项目主要通过包级初始化和显式调用），无框架式 DI。

## 常见阅读路径
1) 从 `main.go` 了解启动顺序与关键初始化。
2) 看 `router/main.go` 理解路由分拆；再按需进入 `router/relay-router.go`、`router/api-router.go`。
3) 对照 `middleware/` 了解请求链路上的横切逻辑。

## 提示
- 默认嵌入静态资源：如果仅启动后端且未构建前端，访问根路径需确保 web/dist 存在（或改用前端 dev）。
- 端口可通过 `PORT` 环境变量调整。

## 参考文件
- `main.go`
- `router/main.go`、`router/api-router.go`、`router/relay-router.go`、`router/video-router.go`、`router/web-router.go`
- `middleware/` 下相关中间件

