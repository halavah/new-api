# 0008. DTO 与控制层

## 适合人群
- 有 Java 背景的 Go 初学者，关注请求绑定、参数校验与控制器职责。

## DTO 作用
- 请求/响应数据结构定义，解耦 HTTP 与内部模型。
- 位置：`dto/` 目录（按场景拆分，如 openai_request, pricing, task, user_settings 等）。

## 控制层职责
- 入口：`controller/` 各文件，负责：
  - 解析/绑定请求（Gin binding/JSON）
  - 参数校验（字段必填、范围、格式）
  - 调用 service/relay，汇总结果
  - 统一错误返回

## 常见控制器示例
- 鉴权/用户：`user.go`、`token.go`
- 渠道/模型：`channel.go`、`model.go`、`model_meta.go`
- 计费/充值：`billing.go`、`topup_*.go`
- Relay 接口：`relay.go`（转发入口）
- 运营/配置：`option.go`、`prefill_group.go` 等

## 参数绑定与校验
- Gin binding：结构体标签 `json:"..." binding:"required"` 等。
- 必要时手动校验（数值范围、合法枚举）。
- 错误处理：controller 捕获后返回标准错误格式。

## 返回格式
- 成功：DTO/对象序列化为 JSON。
- 失败：统一错误码/消息；确保不泄露内部错误详情（必要时用日志记录）。

## 对照 Java 习惯
- 类似 Spring MVC 的 Controller + DTO + Service 模式；但异常不自动传播，需要显式处理 error。
- 中间件替代部分 Filter/Interceptor 作用，controller 关注业务入口与参数。

## 参考文件
- `dto/` 目录各文件
- `controller/` 目录各文件

