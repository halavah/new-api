# 0001. 环境准备与启动流程

## 适合人群
- 有 Java 背景的 Go 初学者，习惯 Maven/Gradle，了解 HTTP/API 基础。

## 环境依赖
- Go 1.25+（编译/运行后端）
- bun（前端依赖与 Vite 开发服务）
- Node/npm（随 bun 提供）
- 可选：Docker / Docker Compose（容器化）
- 数据库：默认 SQLite；可选 MySQL/Postgres

## 后端启动（源码）
- 进入仓库根目录，运行：
  - macOS/Linux：`bin/start-backend.sh`（默认端口 3000）
  - Windows：`bin/start-backend.bat`
- 行为：启动前尝试释放占用端口；使用 `go run main.go`；`web/dist` 缺失时需先前端构建或运行前端 dev。
- 环境变量（常用）：
  - `PORT`（默认 3000）
  - `SQL_DSN`（不设则 SQLite：`one-api.db`）
  - `SESSION_SECRET`（多机必配）
  - `REDIS_CONN_STRING`（如需缓存/会话）

## 前端启动（dev）
- 进入仓库根目录，运行：
  - macOS/Linux：`bin/start-front.sh`（默认端口 5173）
  - Windows：`bin/start-front.bat`
- 行为：启动前尝试释放占用端口；缺少依赖时自动 `bun install`；启动 Vite dev server。
- 环境变量：`WEB_PORT`（默认 5173），若与后端同机需避免端口冲突。

## 容器化启动（简述）
- 复制 `.env` 或设置环境变量，按需调整 `docker-compose.yml`。
- 执行 `docker-compose up -d`（或 `docker compose up -d`），默认暴露 3000 端口，挂载 `./data:/data` 持久化 SQLite。

## 常见坑（Go 初学者视角）
- 端口占用：脚本已尝试释放，但若仍占用可手动设 `PORT=3001`。
- SQLite 文件权限：确保运行用户可写 `one-api.db` 或设置 `SQLITE_PATH`。
- 环境变量大小写：Go 侧严格区分；布尔值多用 `true/false` 字符串。
- 前端代理：`web/package.json` 中 `proxy` 指向 `http://localhost:3000`，确保后端已启动或调整端口。

## 验证
- 后端启动成功后访问 `http://localhost:3000/`（内置静态站点）。
- 前端 dev 启动后访问 `http://localhost:5173/`，与后端交互需代理通畅。

## 参考文件
- `bin/start-backend.sh` / `.bat`
- `bin/start-front.sh` / `.bat`
- `docker-compose.yml`
- `README.md`（快速开始/部署）

